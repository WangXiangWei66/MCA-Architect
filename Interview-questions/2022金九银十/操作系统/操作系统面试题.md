# 操作系统面试题

## 1.共享内存的实现方式

### 基本概念

- 磁盘

- 内存

	- 把应用程序从磁盘加载到内存去运行

	- 以进程的形式去运行

- 高速缓冲存储器cache

- 虚拟内存

	- 内存 + 外存（对换区）

	- 就是对内存的扩充

### 共享内存

- 两个或多个进程能够同时访问同一块物理内存空间的现象

- 目的

	- 节省内存空间

	- 实现进程的数据交换，进程通信

- 1.物理内存共享

	- OS把同一块物理内存空间分配给不同进程

	- 由进程主动发起（shmget()）

	- OS根据申请空间大小，计算分页数（每页4k，需要9k，则分配3个页）

	- shmget() 返回一个共享内存ID：shmid，其它可以通过此ID添加到自己的地址空间

- 2.内存映射文件共享

	- OS创建一个空文件，把空文件添加到不同进程的分段（主程序段、子程序段、数据段）中，每个进程都有相同的文件，指向同一块物理空间

	- 该文件对应一块物理内存空间（4k）

	- 文件？

		- 一块存储空间

- 对比

	- 不同点

		- 物理内存

			- OS把同一块物理空间分配给不同进程

		- 内存映射文件

			- OS把同一文件分配给不同进程

	- 相同点

		- 都是tmpfs——基于内存的临时文件系统

			- 一切皆文件

		- 不同进程处理数据不同（类型、格式），采用格式化的数据

		- 都是操作内存，效率相当

## 2.进程间通信的方式有哪些？
最快的是什么？

### 共享内存（shared memory）

- 最快

### 消息传递（Message-Passing）

- 基本概念

	- OS提供收发消息的原语（send()，receive()）

	- 原语

		- OS具有特定功能的程序，OS把这些使用频率较高的代码段进行了封装

			- 函数

		- 原子操作

			- 要不一起成功 要不一起失败

		- 举例

			- 进程状态切换

				- 新建

				- 就绪

				- 运行

				- 阻塞

				- 终止

			- 消息发送

			- 系统调用

- 直接通信

	- 一个进程给另一个进程发消息，点对点通信

	- 发到对方的消息缓冲队列里

	- 什么时候看我的邮箱？不确定，无法保证效率

- 间接通信

	- 发消息进程不直接发给收消息进程，而是发到一个公共的“信箱（数据结构）”

	- 收消息进程轮询信箱

	- 布告栏

- 原语本身是高效的，但是消息通信机制，不保证效率

### 管道通信（Pipe）

- 管道的本质，是一块固定大小的缓冲区（4K），就是个文件

- 管道只支持半双工通信，全双工需要两个管道

- 操作双方必须同步，所以效率不高

### 其它

- 信号量

	- 同步机制，一般不作为通信机制

	- 同步锁

		- 一个进程获取锁，其它进程阻塞

		- 只能允许一个进程同时访问共享资源

	- 信号量

		- 一个信号量，里面“三个锁”，可以同时支持三个进程访问共享资源

		- 允许多个进程同时访问共享资源

- socket

	- 不同主机之间的通信方式，RPC

## 3.上下文切换做了什么事情？

### CPU在进程和和进程之间的切换

### 切换流程

- 0.检查是否允许切换

	- 原语、正在处理中断、临界区或其它原子操作中

- 1.保存当前进程上下文

	- PC（正在执行的指令）等专用寄存器，和通用寄存器，保存到PCB中（进程控制块）

- 2.更新PCB信息，比如进程状态

- 3.把此进程移入到队列（就绪队列、或某种原因的阻塞队列）

- 4.选择另一个（处于就绪状态）进程执行，更新其PCB

- 5.更新内存管理的数据结构（段表、页表）

- 6.恢复所选进程上下文，将CPU执行权交给所选进程

### 切换场景

- 1.运行中的进程要求I/O

	- 读写磁盘

	- 网络通信

- 2.进程状态相关操作

	- 阻塞、唤醒、挂起、激活

	- 新建、销毁

- 3.进程执行完成/结束

- 4.一个高优先级进程申请运行（可剥夺式调度/抢占式调度）

- 5.分配给当前进程的时间片用完

## Java线程

### yield其实只是线程调度的一种尝试，让更多的线程获取到执行权

## 进程各状态的区别和联系

### 新建

### 三个基本状态

- （活动）就绪

- 执行

- 阻塞

	- 由于某种原因导致不能继续运行

		- IO操作

		- 同步，没有获取到锁

	- 不同的原因进入不同阻塞队列

### 销毁

### 操作

- 挂起

	- 静止阻塞

	- 暂时不需要当前进程运行了

	- 放到外存（磁盘对换区）

- 激活

	- 静止就绪

